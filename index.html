<!DOCTYPE HTML>
<html>

<head>
    <title>Radioshow</title>

    <link rel="stylesheet" type="text/css" href="styles/style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="/js/socket.io-stream.js"></script>
</head>

<body>

    <div class="header">
        <span class="msg">welcome to radioshow</span>
        <span class="banner">Radioshow</span>
    </div>

    <div class="main">
      <div onClick="togglePlay()" class="btn play">
          <span class="bar bar-1"></span>
          <span class="bar bar-2"></span>
      </div>
    </div>

    <div class="footer">
        <span class=footer-date>2018</span>
    </div>


    <audio id="audio" controls>
      <source src="" type="audio/mpeg">
          Your browser does not support the audio element.
    </audio>

    <script>
        $('body').on('click', '.btn', function(e) {
            e.preventDefault();
            if ($(this).hasClass('play')) {
                $(this).removeClass('play');
                $(this).addClass('pause');
            } else {
                $(this).removeClass('pause');
                $(this).addClass('play');
            }
        });

        var myAudio = document.getElementById("audio");
        function togglePlay() {
            return myAudio.paused ? myAudio.play() : myAudio.pause();
        };

        var socket = io('http://localhost:' + window.location.port);

        var audio = document.getElementById('audioSource');

        console.log("hoi");
        socket.on('start', function(data) {
            console.log("start");
            console.log(data);
            // socket.emit('my other event', { my: 'data' });
            socket.emit('stream', {
                my: 'data'
            });
            console.log("");
            ss(socket).on('audio-stream', function(stream, data) {
                parts = [];
                console.log("DATA -->> ")
                stream.on('data', (chunk) => {
                    console.log(chunk);
                    parts.push(chunk);
                });
                stream.on('end', function() {
                    var audio = document.getElementById('audio');
                    audio.src = (window.URL || window.webkitURL).createObjectURL(new Blob(parts));
                    audio.play();
                });
            });
        });
    </script>
</body>

</html>
